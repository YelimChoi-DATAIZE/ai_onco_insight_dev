# 🧩 기능명세서: Dataize AI 시스템 전반

## 모듈 상세 셜계

---

## 3. 📁 모듈별 상세 설계

### 3.1 Landing / Auth 모듈

| 항목 | 내용 |
|------|------|
| 주요 파일 | `Landing.jsx`, `Services.jsx`, `ContactUs.jsx`, `SignIn.jsx` 등 |
| 주요 기능 | 랜딩 페이지 렌더링, 서비스 소개 카드, 구글 OAuth 인증, 문의 연동 |
| 인증 구조 | JWT 기반 토큰 발급 및 세션 유지, Google OAuth → Mongo 사용자 스키마로 저장 |
| 외부 연동 | Hubspot iframe, Toss Payments SDK |

### 3.2 mCODE Trend 모듈

| 항목 | 내용 |
|------|------|
| 주요 파일 | `mCODETrend.jsx`, `TrendTable.jsx`, `ResultCard.jsx` 등 |
| 키워드 흐름 | React Flow 기반 노드 시각화 → 선택 키워드 기반 PubMed 및 CTG 검색 |
| 데이터 시각화 | AG Grid 테이블, Nivo Bump 차트를 활용한 트렌드 비교 |
| 백엔드 연동 | `/pubmed`, `/mcode`, `/keywords/similar` API |

### 3.3 Analytics 모듈

| 항목 | 내용 |
|------|------|
| 주요 파일 | `DataSheet.jsx`, `Analysis1.jsx`, `Engineering1.jsx`, `Result1~4.jsx` |
| 기능 흐름 | CSV/XLSX 업로드 → 파싱 → 변수 선택 → 분석 실행 → 시각화 결과 출력 |
| 분석 결과 저장 | MongoDB `analysis_results` 컬렉션에 저장 |
| 선택 UI | MUI TransferList, Ribbon 구성, Custom Editor |

---

## 4. 🧬 데이터베이스 설계 (MongoDB)

| 컬렉션명 | 주요 필드 구성 |
|----------|----------------|
| `users` | email, password (hashed), role, institution, created_at |
| `projects` | title, description, user_id, created_at |
| `documents` | filename, content (text), metadata, uploaded_by, project_id |
| `analysis_results` | project_id, variables_used, results(json), created_at |
| `favorites` | user_id, item_type (paper, ctg), item_id, notes(optional) |

> 📌 모든 컬렉션에는 `created_at`, `updated_at` 타임스탬프 포함. 검색 성능을 위한 인덱스 설정 적용 예정.

---

## 5. 🔌 API 설계 (Express.js)

### 🔐 인증 API

| 메서드 | URL | 설명 | 입력값 | 출력값 |
|--------|-----|------|--------|--------|
| POST | `/auth/basic/signup` | 기본 회원가입 | `{ email, password, name }` | 가입 성공 여부 |
| POST | `/auth/basic/signin` | 기본 로그인 | `{ email, password }` | JWT, 사용자 정보 |
| POST | `/auth/google/verify` | 구글 OAuth 토큰 검증 | `{ access_token }` | 사용자 존재 여부 및 정보 |
| POST | `/auth/google/signup` | 구글 사용자 정보 등록 | `{ name, email, institution }` | 가입 성공 여부 |

### 📚 데이터 검색 API

| 메서드 | URL | 설명 | 입력값 | 출력값 |
|--------|-----|------|--------|--------|
| GET | `/pubmed` | 키워드 연도별 논문 트렌드 조회 | `keywords` (query) | `{ data: [...] }` |
| GET | `/keywords/similar` | 유사 키워드 추천 | `keyword` (query) | `{ similar: [...] }` |
| GET | `/mcode` | mCODE 카테고리 필터링 및 집계 | `category`, `search` | `{ result: [...] }` |

---

## 6. 🧪 예외 및 오류 처리

| 케이스 | 처리 방식 |
|--------|-----------|
| JWT 토큰 유효성 오류 | 401 Unauthorized 반환 및 로그인 페이지 리다이렉트 |
| CSV 파싱 실패 | 업로드 취소 및 오류 메시지 출력 |
| 분석 실패 (서버 오류 포함) | 사용자에게 오류 알림 (토스트) 및 재시도 안내 |
| 키워드 검색 결과 없음 | "검색 결과 없음" 메시지 UI 제공 |

---

## 7. 🧑‍💻 개발 환경

| 항목 | 내용 |
|------|------|
| 프론트엔드 | React 18, MUI v6, AG Grid v31, Nivo |
| 백엔드 | Node.js (Express), JWT, MongoDB Atlas |
| 분석 서버 (선택) | Python (FastAPI, pandas, scispacy 등) |
| 배포 환경 | AWS EC2, S3, Route53, Nginx |
| 인증 | Google OAuth 2.0 |

---

## 8. 📈 확장 고려 사항

- 분석 서버 분리 (Python → FastAPI, Celery)
- 사용자 맞춤형 대시보드 구성
- 저장된 분석결과 PDF 변환 및 다운로드 기능
- AI 기반 질의 응답 (Natural Language Query)



## 🔧 상세 기능 테이블

### 🏠 Home / Landing / Auth

| 기능 ID | 기능명             | 설명                          | 입력 / 출력                   | 사용 라이브러리             | 위치 또는 모듈                          |
| ----- | --------------- | --------------------------- | ------------------------- | -------------------- | --------------------------------- |
| H-001 | 랜딩 페이지 렌더링      | 첫 방문 사용자에게 랜딩화면 제공, CTA 포함  | (입력 없음) / React Component | React, MUI           | `landing/src/pages/Landing.jsx`   |
| H-002 | 서비스 소개 카드       | 서비스 종류에 따라 카드 UI로 구성        | 카드 데이터 / MUI 카드 UI        | MUI Card, Typography | `landing/src/pages/Services.jsx`  |
| H-003 | 요금제 페이지         | SaaS 요금제 설명, 가격 및 CTA 버튼 포함 | 요금제 JSON / 클릭 이벤트         | MUI, Toss SDK        | `landing/src/pages/Plans.jsx`     |
| H-004 | Hubspot 문의 폼 연동 | 외부 Hubspot 폼을 iframe으로 삽입   | 없음 / iframe 렌더링           | 외부 embed script      | `landing/src/pages/ContactUs.jsx` |

---

### 🧠 mCODE Trend

| 기능 ID | 기능명              | 설명                                      | 입력 / 출력               | 사용 라이브러리                   | 위치 또는 모듈                                |
| ----- | ---------------- | --------------------------------------- | --------------------- | -------------------------- | --------------------------------------- |
| M-001 | mCODE Flow 인터페이스 | React Flow를 통해 연구 키워드를 시각화 및 탐색 가능      | 노드/엣지 JSON / 시각 노드 UI | `@xyflow/react`, reactflow | `landing/src/pages/mCODETrend.jsx`      |
| M-002 | 트렌드 테이블 시각화      | 연도별 키워드 트렌드를 AG Grid 또는 Bump Chart로 시각화 | 키워드 + 연도 / 테이블 or 차트  | AG Grid, @nivo/bump        | `mcode-trend/components/TrendTable.jsx` |
| M-003 | RAG 기반 논문 검색     | PubMed + ClinicalTrials.gov를 통합 검색      | 키워드 / 논문 결과 리스트       | axios, RAG 백엔드             | `mcode-trend/components/ResultCard.jsx` |
| M-004 | 연관 키워드 추천        | 입력 키워드 기반 유사 키워드 또는 추론 키워드 제공           | 검색어 / 추천 키워드 배열       | 유사도 모델, 검색 API             | 백엔드 API `/keywords/similar`             |

---

### 📊 Analytics & Data Integration

| 기능 ID | 기능명            | 설명                                     | 입력 / 출력                 | 사용 라이브러리                        | 위치 또는 모듈                                |
| ----- | -------------- | -------------------------------------- | ----------------------- | ------------------------------- | --------------------------------------- |
| A-001 | 데이터 업로드        | 사용자로부터 CSV/XLSX 파일 업로드                 | 파일 / 파싱된 JSON           | PapaParse, xlsx                 | `analytics/components/DataSheet.jsx`    |
| A-002 | 변수 선택 분석       | TransferList 기반 변수 선택 및 분석 항목 구성       | 선택 변수 / 분석 결과 또는 설정     | MUI TransferList, React Context | `analytics/components/Analysis1.jsx`    |
| A-003 | 엔티티 추출 및 코드 매핑 | NER 및 ICD10, SNOMED, RxNorm 등 코드 자동 매핑 | 문서 내용 / 엔티티 및 코드 매핑 결과  | 내부 NER 엔진 + 백엔드 API             | `analytics/components/Engineering1.jsx` |
| A-004 | 분석 시각화 출력      | AG Grid 및 차트, 커스텀 에디터를 통한 결과 시각화       | 분석 데이터 / 차트, 테이블, 피벗 등  | AG Grid, AG Charts, CodeEditor  | `analytics/components/Result1~4.jsx`    |
| A-005 | 프로젝트 및 탭 탐색기   | 사용자가 프로젝트별로 탐색하며 탭 전환 가능               | 프로젝트 구조 / 현재 탭          | Custom TreeView, Tabs           | `analytics/components/ProjectBar.jsx`   |
| A-006 | 분석 옵션 선택 리본    | 분석 기능에 필요한 도구 및 시각화 방식 선택 메뉴           | UI 상의 버튼 클릭 / 분석 실행 트리거 | MUI Button, popup.js            | `analytics/components/Ribbon.jsx`       |

---

### 🔐 인증 및 백엔드 연동 기능

| 기능 ID | 기능명                 | 설명                                          | 입력 / 출력                 | 사용 라이브러리                        | 위치 또는 모듈                        |
| ----- | ------------------- | ------------------------------------------- | ----------------------- | ------------------------------- | ------------------------------- |
| B-001 | Basic 회원가입          | 이메일, 비밀번호 입력 후 사용자 등록 (bcrypt, Mongo 연동)    | 회원정보 입력 / 가입 결과         | bcrypt, express-validator       | `backend/routes/auth/basic.js`  |
| B-002 | Basic 로그인           | 로그인 시 JWT 발급 및 인증 처리                        | 이메일/비번 / JWT, 사용자 정보    | JWT, bcrypt                     | `backend/routes/auth/basic.js`  |
| B-003 | Google OAuth 토큰 검증  | 구글 토큰으로 사용자 인증 및 신규 여부 반환                   | access\_token / 등록 여부   | @react-oauth/google, Google API | `backend/routes/auth/google.js` |
| B-004 | Google 회원가입         | 이름/이메일/기관 등 구글 사용자 정보 등록                    | 사용자 정보 / 가입 결과          | Google OAuth + Mongo            | `backend/routes/auth/google.js` |
| B-005 | PubMed 키워드 검색       | 입력 키워드에 따라 PubMed 데이터 연도별 집계 조회             | keywords / 논문 키워드 연도 분포 | Mongo Aggregation, Express      | `backend/routes/pubmed.js`      |
| B-006 | mCODE KG 필터 및 집계 검색 | category 또는 search term 기반으로 정규식 검색 및 분류 집계 | 검색어 / KG 데이터 및 카운트 정보   | Mongo Regex + Aggregation       | `backend/routes/mcode.js`       |

---

### 🗃 MongoDB 기반 데이터 구조 기능

| 기능 ID | 기능명         | 설명                        | 입력 / 출력            | 관련 컬렉션             | 담당자 |
| ----- | ----------- | ------------------------- | ------------------ | ------------------ | --- |
| D-001 | 사용자 정보 저장   | 이메일, 역할, 소속 등 사용자 등록      | 사용자 정보 / 저장 결과     | `users`            | 김유진 |
| D-002 | 프로젝트 저장     | 프로젝트 제목, 생성자 ID 등 저장      | 프로젝트 정보 / 저장 결과    | `projects`         | 박성우 |
| D-003 | 문서 업로드 및 저장 | 파일 업로드 후 텍스트 추출 및 DB 저장   | 파일, 텍스트 / 저장 확인    | `documents`        | 이서현 |
| D-004 | 분석 결과 저장    | NER, 매핑 결과 등 다양한 분석 결과 저장 | 분석결과 / DB 저장       | `analysis_results` | 최민재 |
| D-005 | 즐겨찾기 논문 저장  | 사용자가 선택한 논문, CTG 결과 등을 저장 | 즐겨찾기 객체 / 저장 성공 여부 | `favorites`        | 정예린 |

> 📦 IndexedDB + MongoDB 연동 구조로 설계 진행 중이며, 사용자 세션과 분석 이력 관리를 효율화할 예정입니다.
